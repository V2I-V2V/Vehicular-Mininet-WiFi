# Analyze scripts

## Usage

### `analyze.py`
Assume the `Vehicular-Mininet-WiFi` is put at home directory.
```
python3 ~/Vehicular-Mininet-WiFi/analysis-scripts/analyze.py -d <data_dir> -p <data_folder_prefix>
```
This will generate a `analysis-results/` directory with figures (in the path where you executed the script).

Required arguments:

* `-d <data_dir>`: `<data_dir>` is the directory to store experiment data, should contain multiple directories begin with `data-<timesamp>`.

Optional arguments:

* `--time_threshold <latency_in_second>`: specify the latency requirement for analysis (# of frames <= `<latency_in_second>`>). Default value is 0.2 s.
* `--task <task_to_analysis>`: `<task_to_analysis>` can be one of `ssim` (currently only support additional anlysis on ssim). `--task ssim` indicates including the SSIM metric for analysis (calculate frames <= latency threshold and >= ssim threshold).
* `--ssim_threshold <ssim_threshold_value>`: specify the ssim requirement for analysis (# of frames >= `<ssim_threshold_value>`), must be used with `--task ssim` at the same time. Default value is 0.6.
* `-p <data_folder_prefix>`: `<data_folder_prefix>` specifies which part of data to analyze. For example, `-k data-0719`  means select all experiments whose folder name begins with `data-0719`.

<!-- * `-f <frame_considered_in_analysis>`: frames taken into account for analysis. For example `-f 300` specifies that for exery node in every experiment, consider the first 300 frames. -->

#### Results generated by `analyze.py`
The results generated by `analyze.py` are:
* `combined.png`: distribution of each experiment
* `schedule_comapre.png`: aggregated results for each scheduling algorithm and their latency distribution
* `<scheduler>.png`: all exerpiment latency distribution with scheduling algorithm `<scheduler>`
* `[location, network, helpee-conf].png`: compare latency distribution of different scheduler on the same setup (loc, network, helpee configs)
* `[location, network, helpee-conf]-cdf.png`: CDF version compare different scheduler fixing other setup (loc, network, helpee configs)
* `[location, network, scheduler, helpee-conf]-per-node.png`: for experiments repeated on exact same setup, the per node mean latency (over all frames considered) and variance of the mean latency
* `[location, network, scheduler, helpee-conf]-frame-node.png`: for experiments repeated on exact same setup, the per frame mean latency and variance of each frame latency on each node


### `analyze_single_exp.py`

This script is used to analyze a single experiment. It should be executed through `run_experiment.py`.

#### Results generated by `analyze_single_exp.py`

The results generated by `analyze_single_exp.py` are:
* `assignments.png`: assignment decision changes accross time by the server. 
* `connect-state.png`: indicate the V2I connectivity of each node across time.
* `latency-adaptive-decisions.png`: Adaptive encoding decisions (along with latency and node bw) for each node. Will be present when adaptive encoding is enabled (TODO: need to change this, for experiment without adaptive encoding, provide a blank figure). 
* `latency-cdf-each-node.png`: Latency cdf of each node.
* `latency-cdf.png`: Overall latency cdf.
* `latency-over-time-each-node.png`: Time series plot for each node's latency.
* `latency-over-time.png`: Latency vs. time for all nodes in 1 figure.
* `node-distances.png`: Distances to all other nodes vs. time for each node.
* `server-helper-helpee-change.png`: Danamic helpers & helpees in collaboration viewed by the server.
* `traj.png`: Trajectory of nodes' locations.
* `v2i-bw.png`: V2I bw of nodes vs. time.

### `analyze_ssim.sh`
Usage:
```
bash ~/Vehicular-Mininet-WiFi/analysis/analyze_ssim.sh <folder prefix> <number of frames to analyze> <reference frame folder>
```
Example (-1 means all the frames):
```
cd ~/v2x/
bash ~/Vehicular-Mininet-WiFi/analysis/analyze_ssim.sh data-08 -1
```
